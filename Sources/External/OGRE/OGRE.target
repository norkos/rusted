TARGET:=OGRE
TYPE:=custom

OGREDEPS_SRC:=$(TARGET_BASE)/ogredeps
OGREDEPS_DIR:=$(BUILD)/OGRE/ogredeps
OGREDEPS_ARTEFACT:=$(OGREDEPS_DIR)/src/FreeImage/libFreeImage.a

OGRE_SRC:=$(TARGET_BASE)/ogre_src_v1-8-1
OGRE_DIR:=$(BUILD)/OGRE/ogre_src_v1-8-1/
OGRE_ARTEFACT:=$(BUILD)/libOgreMain.so.1.8.1

ifneq ($(CMAKE_TOOLCHAIN_FILE),)
  $(info using $(CMAKE_TOOLCHAIN_FILE))
  CMAKE_TOOLCHAIN_OPTIONS:=-DCMAKE_TOOLCHAIN_FILE=$(CMAKE_TOOLCHAIN_FILE)
endif

.PHONY: OGRE

OGRE: $(OGRE_ARTEFACT)

$(OGREDEPS_ARTEFACT):
	mkdir -p $(OGREDEPS_DIR)
	cd $(OGREDEPS_DIR) && \
		cmake -DCMAKE_BUILD_TYPE=Debug $(CMAKE_TOOLCHAIN_OPTIONS) $(OGREDEPS_SRC) && \
		make install && \
		cmake -DCMAKE_BUILD_TYPE=Release $(CMAKE_TOOLCHAIN_OPTIONS) $(OGREDEPS_SRC) && \
		make install

OGRE_CMAKE_OPTIONS:=-DOGRE_DEPENDENCIES_DIR=$(OGREDEPS_DIR)/ogredeps
OGRE_CMAKE_OPTIONS+=-DOGRE_BUILD_RENDERSYSTEM_D3D9="0"
OGRE_CMAKE_OPTIONS+=-DOGRE_BUILD_COMPONENT_PAGING:BOOL="0" \
    -DOGRE_BUILD_COMPONENT_PROPERTY:BOOL="0" -DOGRE_BUILD_COMPONENT_RTSHADERSYSTEM:BOOL="0" \
    -DOGRE_BUILD_TOOLS:BOOL="0" -DOGRE_INSTALL_TOOLS:BOOL="0" -DOGRE_BUILD_COMPONENT_TERRAIN:BOOL="0" \
    -DOGRE_BUILD_PLUGIN_PFX:BOOL="0" -DOGRE_BUILD_PLUGIN_PCZ:BOOL="0" \
    -DOGRE_BUILD_PLUGIN_BSP:BOOL="0" -DOGRE_BUILD_SAMPLES:BOOL="0" \

$(OGRE_ARTEFACT): $(OGREDEPS_ARTEFACT)
	mkdir -p $(OGRE_DIR)
	cd $(OGRE_DIR) && \
		cmake $(CMAKE_TOOLCHAIN_OPTIONS) $(OGRE_CMAKE_OPTIONS) $(OGRE_SRC) && \
		make
	cp -rv $(OGRE_DIR)/lib/* $(BUILD)

